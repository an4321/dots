#!/bin/env fish

if test -z "$argv"
	exit 1
else if test -d "$argv"
	set backup_dirs $HOME/{notes,dots,Desktop,Documents,Pictures}
else
	test ! -d "$argv[1]" && exit 1
	for i in $argv
		test ! -e $i && echo "invalid '$i'" && exit 1
	end
	set backup_dirs $argv[2..-1]
end

set destination "$argv[1]/backup"
command mkdir -p $destination || exit 1

# backup
for i in $backup_dirs
	set backup_destination "$destination/$(basename $i)"

	if test -e $backup_destination
		set old $backup_destination"-old"
		test -e $old && env rm -rf $old
		command cp -r $backup_destination $old
	end

	rsync -aPhz \
		--exclude={node_modules,.next,.svelte-kit,__pycache__,.venv,vendor} \
		"$i" "$destination"
end
