#!/bin/env fish

function confirm
	read -P "$argv (y/N) " yn && string match -qr '^[Yy]$' $yn || return 1
end

if command -v $argv &>/dev/null "apt"
	sudo apt install -y \
		make gcc libx11-dev libxft-dev libxinerama-dev xorg xsel psmisc libxrandr-dev \
		brightnessctl pamixer pavucontrol playerctl imagemagick libnotify-bin fonts-noto-color-emoji \
		copyq dunst feh nemo i3lock rofi arandr picom
	confirm "install kitty" && eval "$(dirname (status -f))/kitty"
else if command -v $argv &>/dev/null "pacman"
	sudo pacman -S \
		make gcc xorg xorg-xinit base-devel libx11 libxft libxinerama xsel \
		brightnessctl pamixer pavucontrol playerctl imagemagick libnotify noto-fonts-emoji \
		copyq dunst feh nemo i3lock rofi arandr picom kitty
else
	echo "error: unsupported distribution" >&2 && exit 1
end

cd ~/.config/dwm
sudo make install clean

confirm "install nerd-fonts" && begin
	~/dots/bin/install-nf || echo "nf setup failed" >&2
end
confirm "install tlp" && begin
	~/dots/bin/setup/tlp || echo "tlp setup failed" >&2
end
confirm "install ufw" && begin
	~/dots/bin/setup/ufw || echo "ufw setup failed" >&2
end

mkdir -p ~/Pictures/wallpapers
test -z "$(ls $HOME/Pictures/wallpapers)" && confirm "get a wallpaper?" \
	&& wget -O "$HOME/Pictures/wallpapers/$(random).png" "https://picsum.photos/1920/1080?random"

if confirm "create dwm.desktop file"
	chmod +x ~/.xinitrc
	sudo mkdir -p /usr/share/xsessions
	sudo touch /usr/share/xsessions/dwm.desktop
	echo -e "[Desktop Entry]\nEncoding=utf-8\nName=dwm\nExec=$HOME/.xinitrc\nIcon=dwm\nType=xsession" \
		| sudo tee /usr/share/xsessions/dwm.desktop
end
