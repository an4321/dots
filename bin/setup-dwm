#!/bin/env fish

function confirm
	read -P "$argv (y/N) " yn && string match -qr '^[Yy]$' $yn || return 1
end
function check; command -v $argv &>/dev/null || return 1; end
function die; echo "error: $argv" >&2 && exit 1; end

if check "apt"
	sudo apt install -y \
		make gcc libx11-dev libxft-dev libxinerama-dev xorg xsel psmisc libxrandr-dev \
		brightnessctl pamixer pavucontrol playerctl imagemagick libnotify-bin fonts-noto-color-emoji \
		copyq dunst feh nemo i3lock rofi arandr picom
	confirm "install kitty" && eval "$(dirname (status -f))/kitty"
else if check "pacman"
	sudo pacman -S \
		make gcc xorg xorg-xinit base-devel libx11 libxft libxinerama xsel \
		brightnessctl pamixer pavucontrol playerctl imagemagick libnotify noto-fonts-emoji \
		copyq dunst feh nemo i3lock rofi arandr picom kitty
else
	die "unsupported distribution"
end

cd ~/dots/misc/dwm
sudo make install clean

if confirm "create dwm.desktop file"
	chmod +x ~/.xinitrc
	sudo mkdir -p /usr/share/xsessions
	sudo touch /usr/share/xsessions/dwm.desktop
	echo -e "[Desktop Entry]\nEncoding=utf-8\nName=dwm\nExec=$HOME/.xinitrc\nIcon=dwm\nType=xsession" \
		| sudo tee /usr/share/xsessions/dwm.desktop
end
