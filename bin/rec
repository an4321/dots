#!/bin/env fish

set rec_dir "$HOME/Videos/rec"
command mkdir -p $rec_dir
set file $argv
test -z "$file" && set file "$rec_dir/$(date "+%Y-%m-%d-%H:%M").mp4"

set sel (command xrandr | command rg '\bconnected' | fzf)
test -z "$sel" && exit

set res (echo $sel | command awk '{for(i=1;i<=NF;i++) if($i ~ /^[0-9]+x[0-9]+\+[0-9]+\+[0-9]+$/){split($i,a,"+"); print a[1]; exit}}')
set pos (echo $sel | command awk '{for(i=1;i<=NF;i++) if($i ~ /^[0-9]+x[0-9]+\+[0-9]+\+[0-9]+$/){split($i,a,"+"); print a[2]","a[3]; exit}}')

command ffmpeg -hide_banner -loglevel fatal -stats \
  -f x11grab -framerate 30 -video_size $res -i :0.0+$pos $file
