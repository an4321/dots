#!/bin/env bash

remove_arch() {
    if [ "$1" == "all" ]; then
        shift
        if [ "$#" -eq 0 ]; then
            yay -Qq | fzf-tmux -h -m -e +s --preview='yay -Qs {1}' \
                --preview-window 'down:30%' | xargs -r yay -R --noconfirm
            exit 0
        fi
        sudo pacman -Rns "$@"
    else
        sudo pacman -R "$@"
    fi
}

remove_debian() {
    if [ "$1" == "-a" ]; then
        shift
        if [ "$#" -eq 0 ]; then
            apt list --installed | cut -d/ -f1 | fzf-tmux -h -m -e +s \
                --preview="apt-cache show {1} | grep -E '^(Version|Description)'" \
                --preview-window 'down:30%' | xargs -r sudo apt remove --noconfirm
            exit 0
        fi
        sudo apt autoremove --purge -y "$@"
    else
        sudo apt remove -y "$@"
    fi
}

# Check the Linux distribution
if [ -f /etc/os-release ]; then
    . /etc/os-release
    case "$ID" in
        arch)
            remove_arch "$@"
            ;;
        debian|ubuntu|linuxmint|raspbian)
            remove_debian "$@"
            ;;
        *)
            echo "Unsupported distribution: $ID"
            ;;
    esac
else
    echo "/etc/os-release not found. Unable to determine the distribution."
fi

