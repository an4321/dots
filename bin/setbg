#!/bin/env bash

mode="fill"
random=false

# Parse options
while getopts "fctr" opt; do
    case $opt in
        f) mode="fit" ;;
        c) mode="center" ;;
        t) mode="tile" ;;
        r) random=true ;;
        \?)
            echo "Usage: $0 [-f fit] [-c center] [-t tile] [Image File] OR [-r random]"
            exit 1
            ;;
    esac
done

# Remove the parsed options from the positional parameters
shift $((OPTIND-1))

# Check if a wallpaper argument was passed
if [ "$#" -eq 1 ]; then
    wall="$1"
elif "$random"; then
    wall=""
else
    wall=$(nsxiv -otf ~/Pictures/Wallpapers)
fi

[ -z "$wall" ] && wall=$(ls ~/Pictures/Wallpapers/*.{jpg,png} | shuf -n 1)

[ ! -f "$wall" ] && echo "Error: '$wall' not found" && exit 1

# Set the wallpaper
if [ -n "$WAYLAND_DISPLAY" ]; then
    killall swaybg
    nohup swaybg --mode "$mode" --image "$wall" > /tmp/output.log 2> /tmp/error.log &
else
    [[ "$mode" == "fit" ]] && mode="max"
    feh --bg-$mode "$wall"
fi
